var Spin=new Class({Implements:[Events,Options],options:{transition:"horizontal-push",transitionOption:{transition:"linear",duration:600},timer:true,advanceSpeed:4000,pauseOnHover:false,startClockOnMouseOut:true,startClockOnMouseOutAfter:1000,directionalNav:true,captions:true,captionTransition:"fade",captionTransitionOption:{transition:"linear",duration:600},useNav:false,bullets:true,bulletThumbs:false,bulletThumbLocation:"",afterSlideChange:function(){}},initialize:function(c,b){this.setOptions(b);this.slides=c.getChildren("img, div, a");this.spin=c.addClass("spin");this.spinWrap=new Element("div").addClass("spin-wrapper").wraps(this.spin);this.activeSlide=this.slides[0];this.spinWrap.setStyles({width:"100%",height:this.spin.getSize().y});if(this.options.useNav){this.setNavItemActive(0)}this.activeSlide.setStyles({opacity:0,display:"block"});var a=this;this.activeSlide.setStyles({"z-index":3}).get("tween").start("opacity",1).chain(function(){a.slides.each(function(g){g.setStyles({display:"block"})})});if(this.options.timer){this.timer=new Element("div").addClass("timer").inject(this.spinWrap);this.timer.mask=new Element("span").addClass("mask").inject(this.timer);this.timer.rotator=new Element("span").addClass("rotator").inject(this.timer.mask);this.timer.pause=new Element("span").addClass("pause").inject(this.timer);this.degrees=0;this._startClock();this.timer.addEvent("click",function(g){if(!a.timerRunning){a._startClock()}else{a._stopClock()}});if(this.options.startClockOnMouseOut){var d;this.spinWrap.addEvents({mouseleave:function(){d=(function(){if(!a.timerRunning){a._startClock()}}).delay(a.options.startClockOnMouseOutAfter)},mouseenter:function(){clearTimeout(d)}})}}if(this.options.captions){this.caption=new Element("div",{style:"display:block;"}).addClass("spin-caption").inject(this.spinWrap);this._setCaption()}if(this.options.directionalNav){if(this.options.directionalNav=="false"){return false}var e=new Element("div").addClass("slider-nav").inject(this.spinWrap);this.leftBtn=new Element("span").addClass("left").inject(e);this.rightBtn=new Element("span").addClass("right").inject(e);this.leftBtn.addEvent("click",function(g){a._stopClock();a._spin("prev")});this.rightBtn.addEvent("click",function(g){a._stopClock();a._spin("next")})}if(this.options.pauseOnHover){this.spinWrap.addEvent("mouseenter",function(){a._stopClock()})}if(this.options.bullets){this.bullets=new Element("ul").addClass("spin-bullets").inject(this.spinWrap);this.slides.each(function(g,h){new Element("li.slide-bullet-"+h,{text:h+1}).addEvent("click",function(){a._stopClock();a._spin(h)}).inject(a.bullets)});this._setActiveBullet()}if(this.options.useNav){var f=document.getElement(this.options.useNav);var a=this;f.getChildren("li").each(function(h,g){h.addEvent("click",function(i){i.preventDefault();a.showItem(g)})},this)}this.slides.each(function(g){g.addEvent("swipe",function(h){if(h.direction==="left"){a.rightBtn.fireEvent("click")}else{if(h.direction==="right"){a.leftBtn.fireEvent("click")}}h.start;h.end})})},_spin:function(g){var b=this.slides.indexOf(this.activeSlide),h=b,a=g,d=this.slides.length;if(b===a){return false}var c=this;if(this.slides.length===1){return false}if(!this.locked){this.lock();if(g=="next"){h++;if(h==d){h=0}}else{if(g=="prev"){h--;if(h<0){h=d-1}}else{h=g;if(b<h){a="next"}else{if(b>h){a="prev"}}}}var e=this.slides[b];var f=this.slides[h];if(this.options.useNav){this.setNavItemActive(h)}this.activeSlide=f;this._setActiveBullet();e.setStyle("z-index",2);orbitWidth=this.spin.getSize().x;orbitHeight=this.spin.getSize().y;if(this.options.transition==="fade"){f.set("morph",this.options.transitionOption);f.setStyles({opacity:0,"z-index":3});f.get("morph").start({opacity:1}).chain(function(){c.slides[b].setStyle("z-index",1);c.unlock();c.options.afterSlideChange(this)})}else{if(this.options.transition==="horizontal-slide"){f.set("morph",this.options.transitionOption);if(a=="next"){f.setStyles({left:orbitWidth,"z-index":3});f.get("morph").start({left:0}).chain(function(){c.slides[b].setStyle("z-index",1);c.unlock();c.options.afterSlideChange(this)})}if(a=="prev"){f.setStyles({left:-orbitWidth,"z-index":3});f.get("morph").start({left:0}).chain(function(){c.slides[b].setStyle("z-index",1);c.unlock();c.options.afterSlideChange(this)})}}else{if(this.options.transition==="vertical-slide"){f.set("morph",this.options.transitionOption);if(a=="prev"){f.setStyles({top:orbitWidth,"z-index":3});f.get("morph").start({top:0}).chain(function(){c.slides[b].setStyle("z-index",1);c.unlock();c.options.afterSlideChange(this)})}if(a=="next"){f.setStyles({top:-orbitWidth,"z-index":3});f.get("morph").start({top:0}).chain(function(){c.slides[b].setStyle("z-index",1);c.unlock();c.options.afterSlideChange(this)})}}else{if(this.options.transition==="horizontal-push"){f.set("morph",this.options.transitionOption);e.set("morph",this.options.transitionOption);if(a=="next"){f.setStyles({left:orbitWidth,"z-index":3});f.get("morph").start({left:0}).chain(function(){c.slides[b].setStyle("z-index",1);c.unlock();c.options.afterSlideChange(this)});e.get("morph").start({left:-orbitWidth}).chain(function(){c.slides[b].setStyle("z-index",1);c.unlock();c.options.afterSlideChange(this)})}if(a=="prev"){f.setStyles({left:-orbitWidth,"z-index":3});f.get("morph").start({left:0}).chain(function(){c.slides[b].setStyle("z-index",1);c.unlock();c.options.afterSlideChange(this)});e.get("morph").start({left:orbitWidth}).chain(function(){c.slides[b].setStyle("z-index",1);c.unlock();c.options.afterSlideChange(this)})}}}}}this._setCaption()}},showItem:function(a){this._stopClock();this._spin(a)},_setActiveBullet:function(){if(!this.options.bullets){return false}else{var a=this.slides.indexOf(this.activeSlide);this.bullets.getChildren().each(function(b,c){if(c===a){b.addClass("active")}else{b.removeClass("active")}})}},_startClock:function(){var a=this;if(!this.timer.isVisible()){this.clock=(function(b){a._spin("next")}).periodical(this.options.advanceSpeed)}else{this.timerRunning=true;this.timer.pause.removeClass("active");this.clock=(function(c){var b="rotate("+a.degrees+"deg)";a.degrees+=2;a.timer.rotator.setStyles({"-webkit-transform":b,"-moz-transform":b,"-o-transform":b,transform:b});if(a.degrees>180){a.timer.rotator.addClass("move");a.timer.mask.addClass("move")}if(a.degrees>360){a.timer.rotator.removeClass("move");a.timer.mask.removeClass("move");a.degrees=0;a._spin("next")}}).periodical(this.options.advanceSpeed/180)}},_stopClock:function(){if(!this.options.timer||this.options.timer=="false"){return false}else{this.timerRunning=false;clearInterval(this.clock);this.timer.pause.addClass("active")}},_setCaption:function(){var a=this.activeSlide.get("rel");this.caption.setStyles({opacity:0,visibility:"visible",display:"block"});if(this.options.captions&&a!==undefined&&a!==""&&a!==null){this.caption.set("text",a);if(this.options.captionTransition==="fade"){this.caption.set("morph",this.options.captionTransitionOption);this.caption.morph({opacity:1})}else{if(this.options.captionTransition==="none"){this.caption.fade("show")}}}},unlock:function(){this.locked=false},lock:function(){this.locked=true},setNavItemActive:function(a){var b=document.getElement(this.options.useNav);b.getChildren("li").removeClass("active");b.getChildren("li")[a].addClass("active")}});Element.implement({spin:function(a){new Spin(this,a);return this}});